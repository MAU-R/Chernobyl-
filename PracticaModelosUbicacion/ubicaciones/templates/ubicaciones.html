{% extends 'layout.html'%}

{%block title%}ubicaciones{%endblock%}

{%block content%}
<script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />

<div id="map"></div>

<script>
    var longitude1 = "{{longitude1}}"
    var map = L.map('map').
    setView([41.66, -4.72], 
    14);
    
    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
        maxZoom: 2
    }).addTo(map);
    L.control.scale().addTo(map);
</script>  

<script>
    var dat = "{{datos|escapejs}}"
    var arreglo=dat.split('{')
    arreglo.splice(0,1)
    console.log(arreglo)
    arreglo.forEach(ubicacion => {
        console.log("ahora")
        var ubi = ubicacion.split(',');
        console.log(ubi)
        var long= ubi[6].split(':');
        var lat= ubi[5].slice(0,-1)
        var lng=long[1].slice(0,-1)
        L.marker([lat, lng], {draggable: true}).addTo(map);  
    });
   
</script>
 
<script>
    var popup = L.popup();
    function onMapClick(e) {
        popup
            .setLatLng(e.latlng) // Sets the geographical point where the popup will open.
            .setContent("Has hecho click en la coordenada:<br> " +  e.latlng.lat.toString() + "," +  e.latlng.lng.toString()) // Sets the HTML content of the popup.
            .openOn(map); // Adds the popup to the map and closes the previous one. 
    }
    
    map.on('click', onMapClick);
</script>
{%endblock%}